\chapter{Monte Carlo Methods for Neutral Particle Transport}
\label{ch:neutral_particle_transport}
In any Monte Carlo process, information collected from samples of the parent 
population will only be useful if the probability laws governing the sampling
are an accurate represention of a physical process. In this chapter, the 
probability laws governing the sampling of neutral particle histories (i.e. 
neutrons and photons) will be derived for the forward process. After a 
discussion of the various probability laws is given, the probability laws
governing the sampling of neutral particle histories will be derived for the
reverse process. In addition, the methods used to calculate the adjoint
cross section data will be discussed.

\section{Derivation of Random Walk PDFs for the Forward Process}
\label{sec:der_prob_laws_for_proc}
To use the Monte Carlo process that was discussed in the previous section to
estimate a solution to the transport equation, the transport equation must
be written as a Fredholm integral equation of the second kind. A commonly
referenced form of the transport equation is the integro-differential 
Boltzmann equation. It will be shown how to derive the integral form of the
transport equation. Similar derivations to the one that will be shown can also
be found in several references \citep{lewis, hoogenboom, irving}.

Equation \ref{eq:integro_diff_boltzmann_eqn} is the time dependent Boltzmann
equation, which is a balance equation that describes the transport of fluid
in a medium. The fluid is assumed to have a continuous distribution throughout
the medium. For the purposes of this report, the fluid of interest is a
population of particles (neutrons or photons). 
\begin{equation}
  \begin{split}
    \frac{1}{v}&\frac{\partial \varphi(\vec{r},E,\hat{\Omega},t)}{\partial t} +
    \hat{\Omega} \cdot \vec{\bigtriangledown} \varphi(\vec{r},E,\hat{\Omega},t)
    + \Sigma_T(\vec{r},E) \varphi(\vec{r},E,\hat{\Omega},t) = \\
    & \quad S(\vec{r},E,\hat{\Omega},t) +
    \int\int \Sigma_S(\vec{r},E^{'} \to E,\hat{\Omega^{'}} \to \hat{\Omega})
    \varphi(\vec{r},E,\hat{\Omega^{'}},t) dE^{'}d\hat{\Omega^{'}} 
  \end{split}
  \label{eq:integro_diff_boltzmann_eqn}
\end{equation}
\begin{eqnarray*}
  \vec{r} & = & \text{spacial coordinate} \nonumber \\
  E & = & \text{particle energy} \nonumber \\
  \hat{\Omega} & = & \text{flight direction} \nonumber \\
  t & = & \text{time} \nonumber \\
  v & = & \text{particle speed} \nonumber \\
\end{eqnarray*}
The continuous function, $\varphi(\vec{r},E,\hat{\Omega},t)$, that equation 
\ref{eq:integro_diff_boltzmann_eqn} describes is the particle flux. The
quantity $\varphi(\vec{r},E,\hat{\Omega},t)dEd\hat{\Omega}$ can be interpreted
as the particle flux at $\vec{r}$ and time t for particles with energy between
$E$ and $E + dE$ and in the direction of the solid angle $d\hat{\Omega}$ about
$\hat{\Omega}$. The function $\Sigma_T(\vec{r},E)$ describes the total cross
section at $\vec{r}$ for particles with energy $E$. The differential scattering
cross section is represented by the function 
$\Sigma_S(\vec{r},E^{'} \to E,\hat{\Omega^{'}} \to \hat{\Omega})$. The quantity
$\Sigma_S(\vec{r},E^{'} \to E,\hat{\Omega^{'}} \to \hat{\Omega})dEd\hat{\Omega}$
can be interpreted as the scattering cross section at $\vec{r}$ for particles
leaving a collision with energy between $E$ and $E+dE$ and direction in the
solid angle $d\hat{\Omega}$ about $\hat{\Omega}$ given a particle with energy
$E^{'}$ and direction $\hat{\Omega^{'}}$ going into the collision. The external
particle source is described by the function $S(\vec{r},E,\hat{\Omega},t)$.

The left hand side of equation \ref{eq:integro_diff_boltzmann_eqn} describes 
the loss density of particles at $\vec{r}$ with energy $E$ and direction 
$\hat{\Omega}$ for a particular time $t$. The right hand side of the equation 
describes the source density of particles at $\vec{r}$ with energy $E$ and 
direction $\hat{\Omega}$ for a particular time $t$. In this report all
problems discussed will be assumed to be steady state. Therefore, the time
dependence of equation \ref{eq:integro_diff_boltzmann_eqn} will be ignored 
from here. To further simplify equation \ref{eq:integro_diff_boltzmann_eqn} the 
right hand side of the equation will be refered to simply as the emission 
density $\chi(\vec{r},E,\hat{\Omega})$.
\begin{equation}
  \begin{split}
    \chi(\vec{r},E,\hat{\Omega}) = S(\vec{r},&E,\hat{\Omega}) + \\
    & \int\int \Sigma_S(\vec{r},E^{'} \to E,\hat{\Omega^{'}} \to \hat{\Omega})
    \varphi(\vec{r},E,\hat{\Omega^{'}}) dE^{'}d\hat{\Omega^{'}}
  \end{split}
  \label{eq:emission_density}
\end{equation}
The reduced transport equation is shown in the following equation.
\begin{equation}
  \hat{\Omega} \cdot \vec{\bigtriangledown} \varphi(\vec{r},E,\hat{\Omega})
  + \Sigma_T(\vec{r},E) \varphi(\vec{r},E,\hat{\Omega}) =  
 \chi(\vec{r},E,\hat{\Omega})
  \label{eq:reduced_transport_eqn}
\end{equation}

From the reduced transport equation, the method of characteristics will be 
used to transform the reduced transport equation to its integral form
\citep{lewis+miller}. The characteristic for the transport equation is the line
defined by the fixed point $\vec{r}$ and the direction $\hat{\Omega}$. This 
line can be parameterized by the variable $R$ resulting in the following 
equation. 
\begin{equation}
  \vec{r^{'}} = \vec{r} - R\hat{\Omega}
  \label{eq:characteristic}
\end{equation}
Using equation \ref{eq:characteristic} a directional derivative along the
characteristic can be determined.
\begin{eqnarray}
  \frac{d}{dR} & = & \frac{dx^{'}}{dR}\frac{\partial}{\partial x} +
  \frac{dy^{'}}{dR}\frac{\partial}{\partial y} +
  \frac{dz^{'}}{dR}\frac{\partial}{\partial z} \nonumber \\
  & = & -\Omega_x \frac{\partial}{\partial x} -
  \Omega_y \frac{\partial}{\partial y} -
  \Omega_z \frac{\partial}{\partial z} \nonumber \\
  & = & -\hat{\Omega} \cdot \vec{\bigtriangledown}
\end{eqnarray}
Using this relationship of the directional derivative along the characteristic
the transport equation can be reduced to a first order ordinary differential 
equation (ODE), which can be easily solved with the integrating factor
$exp\left[-\int_0^R \Sigma_T(\vec{r}-R^{'}\hat{\Omega},E)dR^{'} \right]$.
\begin{equation*}
  -\frac{d}{dR}\varphi(\vec{r^{'}},E,\hat{\Omega}) + \Sigma_T(\vec{r^{'}},E)
  \varphi(\vec{r^{'}},E,\hat{\Omega}) = 
  \chi(\vec{r^{'}},E,\hat{\Omega})
\end{equation*}
\begin{equation*}
  \begin{split}
    -\frac{d}{dR}\bigg[\varphi(\vec{r^{'}},E,\hat{\Omega})
      &exp\left[-\int_0^R \Sigma_T(\vec{r}-R^{'}\hat{\Omega},E)dR^{'}\right]
      \bigg] = \\
    & \chi(\vec{r^{'}},E,\hat{\Omega})
    exp\left[-\int_0^R \Sigma_T(\vec{r}-R^{'}\hat{\Omega},E)dR^{'} \right]
  \end{split}
\end{equation*}
\begin{equation*}
  \begin{split}
    -\varphi(\vec{r} - R\hat{\Omega},&E,\hat{\Omega})
    exp\left[-\int_0^R \Sigma_T(\vec{r}-R^{'}\hat{\Omega},E)dR^{'}\right] 
    \bigg|_0^{\infty} = \\
    & \int_0^{\infty} 
    \chi(\vec{r} - R\hat{\Omega},E,\hat{\Omega})
    exp\left[-\int_0^R \Sigma_T(\vec{r}-R^{'}\hat{\Omega},E)dR^{'} \right] dR
  \end{split}
\end{equation*}
\begin{equation}
  \begin{split}
    \varphi(\vec{r},E,&\hat{\Omega}) = \\ 
    & \int_0^{\infty} \chi(\vec{r} - R\hat{\Omega},E,\hat{\Omega})
    exp\left[-\int_0^R \Sigma_T(\vec{r}-R^{'}\hat{\Omega},E)dR^{'} \right] dR
  \end{split}
  \label{eq:line_integral_transport_eqn}
\end{equation}
To get to equation \ref{eq:line_integral_transport_eqn} it was assumed that the
flux goes to zero as $R$ goes to infinity. The right hand size of equation 
\ref{eq:line_integral_transport_eqn} can be interpreted as the source of all
particles with energy $E$ along the line $\vec{r}-R\hat{\Omega}$ with direction
$\hat{\Omega}$. This line integral will now be converted to an integral over 
all space. First, note that $R = |\vec{r} - \vec{r^{'}}|$,
$\hat{\Omega} = \frac{\vec{r} - \vec{r^{'}}}{|\vec{r} - \vec{r^{'}}}|$ and
$dV^{'} = R^2dRd\hat{\Omega^{'}}$.
\begin{equation}
  \begin{split}
    \varphi(\vec{r},E,&\hat{\Omega}) = 
    \int\int \chi(\vec{r^{'}},E,\hat{\Omega^{'}}) \\
    & exp\left[-\int_0^{|\vec{r} - \vec{r^{'}}|} 
      \Sigma_T(\vec{r}-R^{'}\hat{\Omega^{'}},E)dR^{'} \right] 
    \frac{\delta \left(\Omega^{'} - \left[\frac{\vec{r} - \vec{r^{'}}}
        {|\vec{r} - \vec{r^{'}}|}\right]\right)}
    {|\vec{r} - \vec{r^{'}}|^2} dV^{'}
  \end{split}
  \label{eq:volume_integral_transport_eqn}
\end{equation}
Substituting this equation for the flux back into equation 
\ref{eq:emission_density} results in an integral equation in terms of the 
emission density only. 
\begin{equation*}
  \begin{split}
    \chi(\vec{r},&E,\hat{\Omega}) = S(\vec{r},E,\hat{\Omega}) +
    \int\int \Sigma_S(\vec{r},E^{'} \to E, \hat{\Omega^{'}} \to \hat{\Omega})
    \int\int \chi(\vec{r^{'}},E',\hat{\Omega^{''}}) \\
    & exp\left[-\int_0^{|\vec{r} - \vec{r^{'}}|} 
      \Sigma_T(\vec{r}-R^{'}\hat{\Omega^{''}},E)dR^{'} \right]
    \frac{\delta \left(\Omega^{''} - \left[\frac{\vec{r} - \vec{r^{'}}}
        {|\vec{r} - \vec{r^{'}}|}\right]\right)}
    {|\vec{r} - \vec{r^{'}}|^2} dV^{''}dE^{'}d\hat{\Omega^{'}}
  \end{split}
\end{equation*}
\begin{equation}
  \begin{split}
    \chi(\vec{r},&E,\hat{\Omega}) = S(\vec{r},E,\hat{\Omega}) + \\
    &\int_{\Gamma}C(\vec{r},E^{'} \to E,\hat{\Omega^{'}} \to \hat{\Omega})
    T(\vec{r^{'}} \to \vec{r},E^{'},\hat{\Omega^{'}}) 
    \chi(\vec{r^{'}},E',\hat{\Omega^{'}}) d\Gamma^{'}
  \end{split}
  \label{eq:emission_density_integral_eqn}
\end{equation}

The kernel $T(\vec{r^{'}} \to \vec{r},E,\hat{\Omega})$ is called the transport
kernel, which is defined in the next equation.
\begin{equation}
  \begin{split}
    T(\vec{r^{'}} \to \vec{r},&E,\hat{\Omega}) = \Sigma_T(\vec{r},E) \\
    &exp\left[-\int_0^{|\vec{r} - \vec{r^{'}}|} 
      \Sigma_T(\vec{r}-R^{'}\hat{\Omega^{'}},E)dR^{'} \right] 
    \frac{\delta \left(\Omega^{'} - \left[\frac{\vec{r} - \vec{r^{'}}}
        {|\vec{r} - \vec{r^{'}}|}\right]\right)}
    {|\vec{r} - \vec{r^{'}}|^2} 
  \end{split}
\end{equation}
The quantity $T(\vec{r^{'}} \to \vec{r},E,\hat{\Omega})dV^{'}$ can be interpreted
as the probability that a particle at $\vec{r^{'}}$ with energy $E$ and 
direction $\hat{\Omega}$ will have its next collision in volume element $dV$
at $\vec{r}$.

The kernel $C(\vec{r},E^{'} \to E,\hat{\Omega^{'}} \to \hat{\Omega})$ is called
the collision kernel, which is defined in the next equation.
\begin{eqnarray}
  C(\vec{r},E^{'} \to E,\hat{\Omega^{'}} \to \hat{\Omega}) & = & 
  \frac{\Sigma_S(\vec{r},E^{'} \to E,\hat{\Omega^{'}} \to \hat{\Omega})}
       {\Sigma_T(\vec{r},E^{'})} \\
  & = & \frac{\Sigma_S(\vec{r},E^{'})}{\Sigma_T(\vec{r},E^{'})}
       \frac{\Sigma_S(\vec{r},E^{'} \to E,\hat{\Omega^{'}} \to \hat{\Omega})}
            {\Sigma_S(\vec{r},E^{'})} \nonumber \\
  & = & \frac{\Sigma_S(\vec{r},E^{'})}{\Sigma_T(\vec{r},E^{'})} \sum_i
        \frac{\Sigma_{S,i}(\vec{r},E^{'})}{\Sigma_S(\vec{r},E^{'})}
        f_i(\vec{r},E^{'} \to E,\hat{\Omega^{'}} \to \hat{\Omega}) \nonumber
\end{eqnarray}

The transition and collision kernels can be combined to create a kernel that
characterizes the transition of a particle from a state 
$y = (\vec{r^{'}},E^{'},\hat{\Omega^{'}})$ of the phase space $\Gamma$ to another 
state $x = (\vec{r},E,\hat{\Omega})$. This new kernel is given in the following 
equation.
\begin{equation}
  K(y \to x) =
  C(\vec{r},E^{'} \to E,\hat{\Omega^{'}} \to \hat{\Omega})
    T(\vec{r^{'}} \to \vec{r},E^{'},\hat{\Omega^{'}})
\end{equation}
The integral equation of the emission density shown in equation 
\ref{eq:emission_density_integral_eqn} can now be represented as
\begin{equation*}
  \chi(x) = S(x) + \int_{\Gamma} K(y \to x)\chi(y)dy,
\end{equation*}
which is a Fredholm integral equation of the second kind. Using the Monte Carlo
random walk process outlined in the previous section, the emission density
can be estimated. 

Another quantity of interest, which is directly related to both the flux and 
the emission density is the collision density. It is defined simply as
\begin{eqnarray}
  \psi(\vec{r},E,\hat{\Omega}) & = & \Sigma_T(\vec{r},E)
  \varphi(\vec{r},E,\hat{\Omega}) \\
  & = & \int\int T(\vec{r^{'}} \to \vec{r},E,\hat{\Omega})
  \chi(\vec{r^{'}},E,\hat{\Omega})dV^{'}
\end{eqnarray}
Where as the emission density is the density of particles exiting a collision
or the source, the collision density is the density of particles entering a 
collision. Using a similar procedure to the one followed to derive the 
integral equation for the emission density, an integral equation for the 
collision density can be derived:
\begin{equation*}
  \psi(x) = \psi_1(x) + \int_{\Gamma} L(y \to x)\psi(y)dy.
\end{equation*}
In this equation $\psi_1(x)$ is the first collided source and $L(y \to x)$ is
a new kernel that also characterizes the transition of a particle from a state 
$y = (\vec{r^{'}},E^{'},\hat{\Omega^{'}})$ of the phase space $\Gamma$ to another 
state $x = (\vec{r},E,\hat{\Omega})$. These functions are defined in the 
following equations.
\begin{equation}
  \psi_1(x) = \int\int T(\vec{r^{'}} \to \vec{r},E,\hat{\Omega})
  S(\vec{r^{'}},E,\hat{\Omega})dV^{'}
\end{equation}
\begin{equation}
  L(y \to x) =
  T(\vec{r^{'}} \to \vec{r},E,\hat{\Omega})
  C(\vec{r'},E^{'} \to E,\hat{\Omega^{'}} \to \hat{\Omega})
\end{equation}

